# game-scraper

`game-scraper` parses saved game-release HTML pages into structured JSON metadata.

## Features

- Rich CLI (`clap`) with subcommands
- Extensive structured logging (`tracing`)
- TOML config that explicitly controls each scraped property
- Per-document provenance (`path`, `bytes`, `sha256`)
- Batch parsing for files and directories
- Error collection without stopping the full run

## Installation

```bash
cargo build --release
```

Binary path:

```bash
target/release/game-scraper
```

## Quick start

Create config:

```bash
cargo run -- init-config --path scrape.toml
```

Parse one HTML file:

```bash
cargo run -- parse tmp/some-game-page.html --config scrape.toml --pretty
```

Parse an entire directory recursively:

```bash
cargo run -- parse tmp --recursive --config scrape.toml --output out.json
```

Parse as NDJSON (one item per line):

```bash
cargo run -- parse tmp --recursive --config scrape.toml --ndjson --output out.ndjson
```

Print effective config:

```bash
cargo run -- print-config --config scrape.toml
```

Generate shell completions:

```bash
cargo run -- completions bash > game-scraper.bash
```

## CLI

Global flags:

- `--config <PATH>` config file path
- `--log-level <LEVEL_OR_FILTER>` tracing filter, default `info`
- `--log-format <auto|pretty|json>` log renderer
- `--no-color` disable ANSI color output

Subcommands:

- `parse`: parse input files/directories and emit JSON
- `init-config`: write default TOML config template
- `print-config`: print effective config as TOML
- `completions`: print shell completion script

## Config

Default config is generated by `init-config`. It has four sections:

- `[output]` JSON formatting behavior
- `[scrape]` field-level extraction toggles
- `[links]` link-domain analytics controls
- `[profile]` layout profile and spoiler section filters

`[output]` supports:

- `pretty_json`: pretty JSON bundle formatting
- `ndjson`: output newline-delimited JSON records

## Output structure

Top-level JSON:

- `tool`: name + version
- `stats`: input/ok/error counts
- `documents`: parsed documents
- `errors`: parse failures with path and error details

Per document:

- `source`: path, byte size, SHA-256
- `site`: detected layout profile name
- `page`: title/canonical/meta (if enabled)
- `post`: post-level metadata (if enabled)
- `release`: release metadata block (if enabled)
- `spoiler_sections`: extracted spoiler text sections
- `link_domain_counts`: domain-only link counts
- `download_section_headings`: matching heading text
- `torrent_file`: whether one or more torrent-file links were found
- `torrent_file_names`: anchor text labels for torrent-file links
- `torrent_file_links`: extracted torrent-file URLs
- `magnet_links`: extracted magnet URIs

## Notes

- The parser supports a WordPress-style release layout plus a generic fallback.
- HTML files under `tmp/` can be used as local test fixtures.
